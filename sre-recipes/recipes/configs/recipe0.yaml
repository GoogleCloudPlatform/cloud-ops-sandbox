name: Currency Recipe
description: |
  This implements recipe 0, which purposefully introduces latency into the 
  frontend service by doing a lot of unnecessary currency conversions.
config:
  break:
    - run: kubectl set env deployment/frontend CONVERT_CURRENCIES=true
    - run: kubectl delete pod $(kubectl get pod -l app=frontend -o jsonpath='{.items[0].metadata.name}')
    - run: kubectl wait --for=condition=available --timeout=600s deployment/frontend
  restore:
    - run: kubectl set env deployment/frontend CONVERT_CURRENCIES=false
    - run: kubectl delete pod $(kubectl get pod -l app=frontend -o jsonpath='{.items[0].metadata.name}')
    - run: kubectl wait --for=condition=available --timeout=600s deployment/frontend
  hint: |
    Visit the external IP of the demo application to see if there are any 
    visible changes. You can also use monitoring dashboards to see metrics 
    associated with each service. Note: It may take up to 5 minutes for 
    monitoring metrics to be updated. You can also use `sandboxctl describe`
    to get information (such as project ID, logs, core URLs) for your sandbox.
  verify:
    broken_service:
      choices:
        - Ad  # 0
        - Cart  # 1
        - Checkout  # 2
        - Currency  # 3
        - Email # 4
        - Frontend  # 5
        - Payment # 6
        - Product Catalog # 7
        - Rating  # 8
        - Recommendation  # 9
        - Shipping  # 10
      answer: 5
    broken_cause:
      choices:
        - Dropped Requests # 0
        - Failed connections to other services # 1
        - High latency # 2
        - High memory usage # 3
        - Memory Quota Exceeded # 4
        - Internal Server Error # 5
      answer: 2
